<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dao.articles.ReCommentsDao">
  <resultMap id="ReCommentsResultMap" type="com.domain.articles.ReComments">
    <id column="comment_id" jdbcType="BIGINT" property="commentId" />
    <result column="comment_like_count" jdbcType="BIGINT" property="commentLikeCount" />
    <result column="comment_date" jdbcType="TIMESTAMP" property="commentDate" />
    <result column="parent_comment_id" jdbcType="VARCHAR" property="parentCommentId" />
    <result column="comment_state" jdbcType="INTEGER" property="commentState" />
    <result column="comment_content" jdbcType="LONGVARCHAR" property="commentContent" />
    <association property="reArticles"
                 javaType="ReArticles"
                 resultMap="com.dao.articles.ReArticlesDao.ReArticlesResultMap">
    </association>
    <association property="reUsers"
                 javaType="ReUsers"
                 resultMap="com.dao.user.ReUsersDao.ReUsersResultMap">
    </association>
  </resultMap>


  <!-- 获取文章的树形评论 -->
  <select id="ArticlesTreeComments" resultMap="ReCommentsResultMap" parameterType="ReComments">
    SELECT c.* , u.user_name
    FROM re_comments c LEFT JOIN re_users u ON c.user_id = u.user_id WHERE c.article_id = #{reArticles.articleId}
  </select>

  <!-- 新增评论 -->
  <insert id="addComments" parameterType="ReComments">
    INSERT INTO re_comments VALUES
     <choose>
      <when test="parentCommentId != null and parentCommentId != ''">
        (NULL,#{reUsers.userId},#{reArticles.articleId},0,NOW(),#{commentContent},#{parentCommentId},1);
      </when>
      <otherwise>
        (NULL,#{reUsers.userId},#{reArticles.articleId},0,NOW(),#{commentContent},0,1);
      </otherwise>
    </choose>
  </insert>

</mapper>